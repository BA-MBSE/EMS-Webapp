
<div class="mms-search">
    <div class="mms-search-input" ng-hide="advanceSearch">
        <form class="form-inline" ng-submit="newSearch(searchText)">
            <!-- search type menu -->
            <div class="form-group">
                <label class="sr-only" for="searchTypeSelect">Search type menu</label>
                <select class="form-control" id="searchTypeSelect" ng-model="searchType">
                    <option value="all">All Fields</option>
                    <option value="name">Name</option>
                    <option value="documentation">Documentation</option>
                    <option value="value">Value</option>
                    <option value="id">ID</option>
                    <option value="metatype">Metatype</option>
                </select>
            </div>
            <!-- search keyword input -->
            <div class="form-group" ng-show="searchType != 'metatype'">
                <label class="sr-only" for="searchInput">Search keyword</label>
                <input class="form-control" type="text" id="searchInput" ng-model="searchText" autofocus/>
            </div>
            <div class="form-group" ng-if="searchType === 'metatype'">
                <label class="sr-only" for="searchMetatypeSelect">Search metatype menu</label>
                <!-- <select class="form-control" id="searchMetatypeSelect" ng-model="searchMetatype">
                    <i class="{{metatypeSearch}}"></i>
                    <option ng-repeat="metatype in metatypeList" value="metatype.id">{{metatype.name}}</option>
                </select> -->
                <div id="searchMetatypeSelect" ng-dropdown-multiselect="" options="metatypeList" selected-model="selectedSearchMetatypes" extra-settings="metatypeSettings"></div>
            </div>
            <button class="btn btn-primary" type="button" ng-click="newSearch(searchText)">
                <span class="btn-text">SEARCH</span> <i class="{{searchClass}}"></i>
            </button>
            <div class="search-filter-views-docs">
                <input type="checkbox" ng-model="docsviews.selected"> Search for Views and Documents<br>
            </div>
        </form>
        <div class="misc-form-field">
            <a class="pull-right" ng-click="advanceSearch = !advanceSearch">Advanced</a>
        </div>
    </div>
    <div class="mms-search-input" ng-if="advanceSearch">
        <div class="misc-form-field">
            <a ng-click="advanceSearch = !advanceSearch">Basic Search</a>
        </div>
        <h3>Advanced Search</h3>
        <!-- submit change -->
        <form class="form-inline" ng-submit="newSearch(searchText)">
            <!-- advanced search query input -->
            <div class="form-group">
                <label class="sr-only" for="searchText">Advanced search query (disabled)</label>
                <div class="col-sm-10">
                    <input class="form-control" type="text" id="searchText" ng-model="searchText" disabled />
                </div>
            </div>
            <button class="btn btn-primary" type="button" ng-click="newSearch(searchText)">
                <span class="btn-text">SEARCH</span> <i class="{{searchClass}}"></i>
            </button>
        </form>
        <br>

        <div class="form-inline">
            <!-- search type menu -->
            <div class="form-group">
                <label class="sr-only" for="searchTypeSelect">Search type menu</label>
                <select class="form-control" id="searchTypeSelect" ng-model="searchType">
                    <option value="all">All Fields</option>
                    <option value="name">Name</option>
                    <option value="documentation">Documentation</option>
                    <option value="value">Value</option>
                    <option value="id">ID</option>
                    <option value="metatype">Metatype</option>
                </select>
            </div>
            <div class="form-group">
                <div class="col-sm-10">
                    <label class="sr-only" for="searchText">Advanced search query</label>
                    <input class="form-control" type="text" id="searchText" ng-model="searchText" autofocus/>
                </div>
            </div>
        </div>
        <br>

        <!-- Advanced search rows -->
        <div ng-repeat="row in advanceSearchRows">
        <div class="form-inline">
            <!-- operator -->
            <div class="form-group">
                <label class="sr-only" for="operator-{{$index}}">Search row operator</label>
                <select class="form-control" id="operator-{{$index}}" ng-model="row.operator">
                    <option value="and">And</option>
                    <option value="or">Or</option>
                    <option value="not">Not</option>
                </select>
            </div>
            <!-- search type menu -->
            <div class="form-group">
                <label class="sr-only" for="searchTypeSelect-{{$index}}">Search type menu</label>
                <select class="form-control" id="searchTypeSelect-{{$index}}" ng-model="row.searchType">
                    <option value="all">All Fields</option>
                    <option value="name">Name</option>
                    <option value="documentation">Documentation</option>
                    <option value="value">Value</option>
                    <option value="id">ID</option>
                    <option value="metatype">Metatype</option>
                </select>
            </div>
            <div class="form-group">
                <div class="col-sm-10">
                    <label class="sr-only" for="searchText-{{$index}}">Advanced search query</label>
                    <input class="form-control" type="text" id="searchText-{{$index}}" ng-model="row.searchText" autofocus/>
                </div>
            </div>
            <a type="button" ng-click="removeRowAdvanceSearch(row)">
                <i class="fa fa-times"></i>
            </a>
            <!-- <a type="button" ng-click="advanceSearchRows.push({operator:'and',searchType:'all'})">
                <i class="fa fa-plus"></i>Add Row
            </a> -->
        </div>
        <br>
        </div>
        <a type="button" ng-click="advanceSearchRows.push({operator:'and',searchType:'all'})">
            <i class="fa fa-plus"></i>Add Row
        </a>
    </div>


    <div class="misc-form-field" ng-show="searchResults">
        <div>Showing {{filteredElms.length}} <!--of {{searchResults.length}} -->search results. (Page {{currentPage + 1}})</div>
    </div>
    <div class="container-fluid" ng-show="searchResults.length > 0">
        <div class="elem-wrapper" ng-repeat="elem in filteredElms = (searchResults | filter: resultFilter)">
            <hr>
            <div class="elem-name-wrapper">
                <a class="elem-name" ng-click="userResultClick(elem, 'name')">{{elem.name}}</a>
                <a class="elem-name" ng-show="elem.type == 'Slot'" ng-click="userResultClick(elem, 'name')"><mms-transclude-name mms-element-id="{{elem.definingFeatureId}}" mms-project-id="{{elem._projectId}}" mms-ref-id="{{elem._refId}}" no-click="true"></mms-transclude-name></a>
            </div>
            <div class="elem-qualified-name-wrapper">
                <div class="elem-qualified-name">
                    {{elem._qualifiedName}}
                </div>
            </div>
            <div class="elem-documentation-wrapper">
                <label>Documentation:</label>
                <div class="elem-documentation">
                    <a ng-show="elem.documentation" ng-bind-html="elem.documentation | limitTo:300" ng-click="userResultClick(elem, 'doc')"></a><span class="ellipses">{{elem.documentation.length > 300 ? ' ...' : ''}}</span>
                    <span><a ng-show="!elem.documentation" ng-click="userResultClick(elem, 'doc')">
                      {{emptyDocTxt}}
                      </a></span>
                </div>
            </div>
            <div class="elem-type-wrapper">
                <label>Metatypes:</label>
                <span class="elem-type">{{elem.type}}</span><span ng-if="elem._appliedStereotypeIds.length">,</span>
                <span ng-repeat="type in elem._appliedStereotypeIds" class="elem-type">
                    <mms-transclude-name mms-element-id="{{type}}" mms-project-id="{{elem._projectId}}" mms-ref-id="{{elem._refId}}" no-click="true"></mms-transclude-name><span ng-if="!$last">,</span>
                </span>
            </div>
            <div ng-if="(elem.type === 'Property' || elem.type === 'Port') && elem.defaultValue">
                <label>Value</label>
                <div class="elem-properties">
                    <a ng-click="userResultClick(elem, 'val')">
                        {{elem.defaultValue.value + '' || elem.defaultValue.body[0] || 'Default Value'}}<span class="ellipses">{{(elem.defaultValue.body[0] && elem.defaultValue.body.length > 1) ? ' ...' : '' }}</span>
                    </a>
                </div>
            </div>
            <div ng-if="elem.type === 'Slot' && elem.value">
                <label>Value</label>
                <div class="elem-properties">
                    <a ng-click="userResultClick(elem, 'val')">
                        <span ng-repeat="val in elem.value">
                            {{val.value + '' || val.body[0] || 'Default Value'}}<span class="ellipses">{{(val.body[0] && val.body.length > 1) ? ' ...' : '' }}</span>{{$last ? '' : ', '}}
                        </span>
                    </a>
                </div>
            </div>
            <div ng-if="elem.type === 'Constraint'">
                <label>Specification</label>
                <div class="elem-specification">
                    <a ng-click="userResultClick(elem, 'val')">
                        {{elem.specification.value + '' || 'Constraint Specification'}}
                    </a>
                </div>
                <a ng-click="userResultClick(elem, 'val')">
                    <div ng-repeat="str in elem.specification.body">
                        <div class="elem-specification">{{str}}</div>
                    </div>
                </a>
            </div>
            <div ng-if="elem._properties[0]" class="elem-properties-wrapper ve-search">
                <label>Properties</label>
                <table>
                    <tbody>
                        <tr ng-repeat="row in elem._properties2">
                            <td ng-repeat="property in row">
                                {{property.name}}<span ng-if="property.type === 'Slot'"><mms-transclude-name mms-element-id="{{property.definingFeatureId}}" mms-project-id="{{elem._projectId}}" mms-ref-id="{{elem._refId}}" no-click="true"></mms-transclude-name></span>: 
                                <a ng-click="userResultClick(property, 'val')">{{property.defaultValue.value}}
                                    <span ng-if="property.type === 'Slot'" ng-repeat="val in property.value|limitTo:4">
                                        <span ng-bind-html="val.value | limitTo:300"></span>
                                        <span ng-bind-html="val.body[0] | limitTo:300"></span>
                                        <span ng-if="!val.value && !val.body[0]">Default Value</span>
                                        <!-- {{$last ? '' : ', '}} -->
                                    </span>
                                    <!-- set variable for limit -->
                                    <span class="ellipses" ng-if="property.value.length > 4">...</span>
                                </a>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <div ng-if="elem._relatedDocuments.length > 0" class="elem-documentation-wrapper">
                <label>Related Documents</label>
                <div ng-repeat="relatedDocument in elem._relatedDocuments" class="elem-documentation">
                    <a ng-repeat="relatedView in relatedDocument._parentViews" ui-sref="project.ref.document.view({documentId: relatedDocument.id, viewId: relatedView.id, projectId: relatedDocument._projectId, refId: relatedDocument._refId, search: undefined})" ng-click="userRelatedClick($event, relatedDocument, relatedView, elem)">
                        <mms-view-link mms-project-id="{{elem._projectId}}" mms-ref-id="{{elem._refId}}" mms-doc-id="{{relatedDocument.id}}" mms-element-id="{{relatedDocument.id}}"></mms-view-link> > <mms-view-link mms-project-id="{{elem._projectId}}" mms-ref-id="{{elem._refId}}" mms-doc-id="{{relatedDocument.id}}" mms-element-id="{{relatedView.id}}"></mms-view-link><br/>
                    </a>
                </div>
            </div>
            <div class="elem-updated-wrapper">
                <div>Updated {{elem._modified | date:'M/d/yy h:mm a'}} by {{elem._modifier}}</div>
            </div>
        </div>
        <hr>
    </div>
    <div class="container-fluid">
        <a ng-show="currentPage > 0" ng-click="prev()">&lt; Prev</a>
        <a ng-show="searchResults.length > 0" class="pull-right" ng-click="next()">Next ></a>
    </div>

    <div class="container-no-results container-fluid" ng-show="searchResults.length === 0">
        <h3>No Results Found.</h3>
    </div>
    <div class="container-fluid" ng-show="searchResults.length === 0">
        <a ng-show="currentPage > 0" ng-click="prev()">&lt; Prev</a>
        <a ng-show="searchResults.length > 0" class="pull-right" ng-click="next()">Next ></a>
    </div>
</div>